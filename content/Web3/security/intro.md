---
title: "安全审计 笔记合集"
date: 2025-08-16
weight: 2
draft: false
tags: ["Web3", "security"]
showToc: true
---

# 简介

Web3，作为一个以去中心化为核心理念的新一代互联网范式，其基石建立在区块链技术——一个不可篡改、透明公开的分布式账本之上。这个账本通过精密的共识机制确保网络参与者能够在无需相互信任的情况下达成一致，这无疑是革命性的

然而，这种“不可篡改”的特性是一把双刃剑。一旦智能合约部署上链，其代码逻辑便永久固化，任何潜在的错误、漏洞或设计缺陷都将被永恒记录，并可能被恶意利用，造成无法挽回的资产损失。在传统互联网中，一个漏洞可以通过“打补丁”快速修复；在区块链世界，修复往往意味着复杂的迁移、昂贵的社区沟通，乃至彻底的失败。因此，**“安全前置”** 的理念在这里被提升到了前所未有的高度

安全审计（Security Audit）正是在这种严苛环境下应运而生的核心质量保障手段。它不再是一种可选的成本，而是智能合约开发生命周期中不可或缺的、防御性的关键环节。一个严谨、深入的审计过程，是项目对自身代码负责、对用户资产负责的最重要体现

> 👉 [0907 审计模板仓库](https://github.com/cgcj0907/audit_template)

> 👉 [0907 审计报告仓库](https://github.com/cgcj0907/0907_audit_reports)

---

## 高层概述 ( 什么是安全审计/智能合约审计？ )

当人们提到"审计"时，通常指的是**安全审查（Security Review）**。这是对智能合约代码进行系统性、专业性的安全检查过程，旨在识别潜在的安全漏洞、逻辑错误和设计缺陷。

## 审计的局限性

**There is no silver bullet ( 感兴趣的同学可以去搜一下该词的意思 ) to auditing**：需要明确的是，审计并非万能的解决方案。即使经过最严格的审计，智能合约仍可能存在：
- 未被发现的复杂逻辑漏洞
- 经济模型的长尾风险
- 与外部协议集成时的未知交互风险
- 编译器或区块链底层本身的潜在问题

一次审计只能提供特定时间点的安全快照，无法保证永久的绝对安全。

## 安全审计的三个阶段

### 第一阶段：初步审查（Initial Review）

#### 1. 范围界定（Scoping）
- 确定审计的具体范围：哪些合约、哪些功能
- 明确审计目标、时间线和交付物
- 了解协议的业务逻辑和设计意图

#### 2. 侦察（Reconnaissance）
- 初步代码阅读和理解架构
- 识别关键组件和依赖关系
- 梳理权限模型和资金流向

#### 3. 漏洞识别（Vulnerability Identification）
- 系统性检查各类安全漏洞
- 结合自动化工具和人工审查
- 从攻击者角度思考可能的攻击向量

#### 4. 报告（Reporting）
- 详细记录发现的每个问题
- 按严重程度分类（危急、高危、中危、低危）
- 提供具体的修复建议和代码示例

### 第二阶段：协议修复与验证

#### 1. 修复问题（Protocol Fixes）
- 开发团队根据审计报告修复漏洞
- 可能需要重新设计部分逻辑
- 确保修复方案不引入新的问题

#### 2. 重新测试与添加测试（Retests and Adds Tests）
- 审计团队验证修复的有效性
- 为修复的部分添加专门的测试用例
- 确保修复后的代码仍能满足业务需求

### 第三阶段：缓解措施审查（Mitigation Review）

#### 1. 侦察（Reconnaissance）
- 审查所有修复的代码变更
- 理解修复方案的安全影响

#### 2. 漏洞识别（Vulnerability Identification）
- 确认原始漏洞已被彻底修复
- 检查修复是否引入了新的攻击面

#### 3. 报告（Reporting）
- 提供最终的审计结论
- 确认所有高风险问题已解决
- 给出部署前的最终建议

## 智能合约开发生命周期

### 1. 规划与设计（Plan & Design）
- 需求分析和功能规划
- 架构设计和模式选择
- 安全考虑融入设计阶段（Security by Design）
- 经济模型和激励机制的数学验证

### 2. 开发与测试（Develop & Test）
- 编写合约代码和单元测试
- 集成测试和端到端测试
- 模糊测试（Fuzzing）和差异化测试
- 测试网部署和模拟攻击

### 3. 智能合约审计与部署后规划
**这不仅仅是一个步骤**，而是一个包含多个子阶段的综合过程（类似于传统软件开发生命周期[SDLC](https://aws.amazon.com/what-is/sdlc/)，但具有区块链特有的安全考量）：

#### 审计准备阶段
- 内部代码审查和清理
- 准备完整的文档和测试覆盖
- 选择适合的审计团队或工具

#### 正式审计阶段
- 如前所述的三个阶段审计流程
- 可能涉及多家审计机构的交叉审计
- 漏洞赏金计划（Bug Bounty）的并行运行

#### 部署后规划
- 紧急响应流程设计
- 升级和迁移策略
- 监控和告警系统设置
- 社区沟通预案

### 4. 部署（Deploy）
- 主网部署和执行初始化
- 验证部署的合约地址和代码哈希
- 设置多签钱包和权限管理
- 进行小规模试点测试

### 5. 监控与维护（Monitor & Maintain）
- 实时监控合约状态和交易
- 定期安全复查和代码更新
- 响应安全事件和漏洞报告
- 协议升级和功能迭代

---

## 审计清单（Checklist）
### 顶级智能合约审计员的清单
* [Simple Security Checklist](https://github.com/nascentxyz/simple-security-toolkit)

* [The Rekt Test](https://blog.trailofbits.com/2023/08/14/can-you-pass-the-rekt-test/)

### 0907 审计清单
现在我还是个小白哈哈哈, 先占个位

---


## 辅助工具推荐
> 👉 [审计辅助工具](/web3/security/auxiliarytools)

## 审计工具推荐

### 静态分析工具
- **Slither**：全面的静态分析框架，支持自定义检测器。  
- **Mythril**：基于符号执行，发现复杂路径条件。  
- **Semgrep**：代码模式匹配，适合快速规则化检查。

### 动态测试工具
- **Foundry（forge）**：本地开发、测试与模糊测试一体化工具，速度快且广泛被采用。  
- **Hardhat**：插件生态丰富，便于与现有工具链集成。  
- **Echidna**：属性驱动的模糊测试工具。

### 形式化验证
- **Certora**：成熟的形式化验证工具，支持复杂规约（Certora Prover & CVL）。  
- **Halmos / Verx / KEVM / SMTChecker**：不同方法的形式化或符号执行工具。  
- **Manticore**：符号执行工具，可用于深度路径探索。

### 监控与响应
- **Forta**：实时链上威胁检测与告警。  
- **Tenderly**：交易模拟、状态回放、错误追踪与调试。  
- **OpenZeppelin Defender**：运维自动化、管理与应急响应工具。

---

## 漏洞等级划分
> 👉 [漏洞等级划分标准](/web3/security/severity)

## 经典漏洞
> 👉 [低级漏洞合集](/web3/security/simple)

### 1. 编译级审计相关漏洞 ( CLV - Compiler-level vulnerability )
> 👉 [编译级漏洞合集](/web3/security/clv)

#### 1.1 构造函数可见性错误（Constructor Visibility）
**问题描述**: 在较早的 Solidity 版本中，构造函数与合约同名；错误实现或版本不匹配可能导致构造函数被外部调用，从而让攻击者获取所有权。  
**审计要点**: 检查 Solidity 编译器版本、构造函数写法（`constructor` 关键字），确认部署后所有者设置正确。

#### 1.2 存储布局冲突（Storage Collision）
**问题描述**: 在代理合约（UUPS、透明代理等）中，Implementation 与代理之间的 storage 布局不一致会导致变量被覆盖或数据损坏。  
**审计要点**: 审查所有合约继承与变量声明顺序，验证 upgrade-safe 模式，使用工具检测可升级合约的存储兼容性（如 OpenZeppelin 的 upgrade plugins / slither 检查器）。

#### 1.3 编译器优化引入的边界情况
**问题描述**: 某些优化选项（例如 IR pipeline、不同优化级别）可能在极端情况下改变字节码行为，尤其是与 inline assembly 交互或者复杂控制流时。  
**审计要点**: 比较不同编译器版本与优化级别下的字节码，进行差异分析与边界测试。

---

### 2. 测试级审计相关漏洞 ( TLV - Test-Level Vulnerabilities)
> 👉 [测试级漏洞合集](/web3/security/tlv)
#### 2.1 重入攻击（Reentrancy）
**问题描述**: 在外部调用（例如发送资金）后未先更新合约状态，恶意合约通过回调重复进入导致资金被多次提取。  
**防护模式**: 使用 Checks-Effects-Interactions 模式、重入锁（`ReentrancyGuard`）以及尽量使用 `transfer`/`call` 的正确模式并检查返回值。

#### 2.2 拒绝服务（Denial of Service）
**问题描述**: 攻击者通过特殊手段使合约功能不可用（如占满 Gas、在回调中 revert、或恶意填充数据使循环耗尽 Gas）。  
**审计要点**: 识别可能被外部控制的数据驱动循环，检查循环与资源消耗边界，设计退避/分页机制。

#### 2.3 前端运行攻击（Front-running / MEV）
**问题描述**: 攻击者在 mempool 中发现有利交易，并通过提高 Gas 或操纵交易顺序来获利。  
**缓解方案**: 提交-揭示、链下批处理、使用隐私交易或原生抵御 MEV 的设计（如闪电套利保护、时间加密机制）。

---

### 3. 静态审计相关漏洞 ( SAV- Static Analysis Vulnerabilities )
> 👉 [静态分析漏洞合集](/web3/security/sav)
#### 3.1 访问控制缺失（Missing Access Control）
**问题描述**: 关键函数没有合适权限校验或权限逻辑存在漏洞（例如误用 `tx.origin`）。  
**审计要点**: 检查所有关键操作、管理入口、升级入口是否严格受限并有事件记录。

#### 3.2 整数溢出/下溢（Integer Overflow/Underflow）
**问题描述**: 在 Solidity 0.8.0 之前，算术不会自动 revert，导致溢出/下溢。  
**防护**: 使用 Solidity 0.8+ 的内置溢出检查，或显式边界校验。

#### 3.3 未检查的外部调用返回值
**问题描述**: 某些代币合约（历史上如 USDT）采用非规范返回值（返回 bool 为 false），若不检查会误判成功。  
**最佳实践**: 使用 `safeTransfer`、检查 `call` 返回值并处理错误。

#### 3.4 delegatecall 风险
**问题描述**: `delegatecall` 在调用目标合约时使用调用者的存储布局，若目标合约未受信任或被替换，会带来极大风险。  
**审计要点**: 确保 delegatecall 目标的源可信并且 storage 布局严格匹配。

---

### 4. 数学 & 经济模型相关漏洞 ( M&EMV - Mathematical & Economic-model vulnerabilities )
> 👉 [数学 & 经济模型漏洞合集](/web3/security/memv)
#### 4.1 价格操纵攻击（Price Manipulation）
**问题描述**: 通过操纵预言机或 DEX 池子来改变价格，进而触发清算或套利。  
**典型场景**: 闪电贷操纵、预言机延迟、低流动性池被操控。  
**防护**: 使用多源预言机、TWAP、滑点限制与保险金/缓冲机制。

#### 4.2 清算机制漏洞
**问题描述**: 清算奖励、触发阈值或计价逻辑设计不当可能被利用，使攻击者能以不合理成本获取抵押资产或导致协议不稳。  
**审计要点**: 检查清算参数、奖励计算公式、边界条件与激励对齐。

#### 4.3 滑点与 MEV（最大可提取价值）
**问题描述**: 验证者或搜索者利用交易顺序产生额外收益（如三明治攻击、回跑等）。  
**防护**: 设计抗前置/抗三明治的交换接口、使用批量结算或最低可接受价格（minAmountOut）校验。

#### 4.4 奖励 / 分配精度损失
**问题描述**: Solidity 无小数类型，精度截断可能导致用户无法领取全部奖励或产生小额残留。  
**审计要点**: 使用高精度基数（如 1e18）并在分配逻辑中处理余数、记录并回收残余。

---

### 5. 形式化验证相关属性
#### 5.1 不变量违反（Invariant Violation）
**问题描述**: 合约应保持的数学或逻辑关系被破坏（例如代币总量、协议准备金等）。  
**实践**: 使用不变量检测工具和形式化工具（如 Certora、SMTChecker）来证明关键不变量成立。

#### 5.2 状态机违规
**问题描述**: 状态转换逻辑允许非法路径（例如已结束的拍卖仍可出价）。  
**审计要点**: 对状态机进行建模与完整性验证，确保无法绕过状态检查。

#### 5.3 访问控制属性（形式化）
**问题描述**: 权限模型中存在隐含或链式授权路径（例如初始化逻辑漏洞导致管理员未被正确设置）。  
**实践**: 使用形式化规范和审查确保只有预期角色能执行敏感操作。

#### 5.4 无重入属性
**问题描述**: 证明某些函数在任何情况下都不会发生重入（即使与外部合约交互）。  
**实践**: 通过状态机建模或形式化证明（Certora/Verx）来验证。

---


# 结语

安全审计是一个持续的过程，而非一次性的任务。随着协议迭代、依赖库更新与市场环境变化，新的风险会不断出现。建立持续监控、漏洞赏金计划与应急响应流程，与一次性的代码审计同样重要。

> 区块链安全的黄金法则：**不信任，要验证（Don't Trust, Verify）**。这既适用于用户对合约的验证，也适用于开发者对自己代码的验证

