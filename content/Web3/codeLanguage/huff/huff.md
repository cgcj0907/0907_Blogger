---
title: "Huff ä½¿ç”¨æŒ‡å—"
date: 2025-05-16
draft: false
tags: ["Web3", "lanuage", "Huff"]
showToc: true
---

# ç®€ä»‹

Huff æ˜¯ä¸€ç§ä½çº§ç¼–ç¨‹è¯­è¨€ï¼Œä¸“ä¸ºåœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ä¸Šå¼€å‘é«˜æ€§èƒ½ã€ä¼˜åŒ–ç¨‹åº¦æé«˜çš„æ™ºèƒ½åˆçº¦è€Œè®¾è®¡ã€‚Huff ä¸éšè— EVM çš„å†…éƒ¨æœºåˆ¶ï¼Œè€Œæ˜¯å°†å…¶ç¼–ç¨‹å †æ ˆæš´éœ²ç»™å¼€å‘è€…ï¼Œä»¥ä¾¿è¿›è¡Œæ‰‹åŠ¨æ“ä½œå’Œç²¾ç»†æ§åˆ¶

Huff æœ€åˆç”± Aztec Protocol å›¢é˜Ÿåˆ›å»ºï¼Œç”¨äºç¼–å†™ Weierstrudelï¼Œè¿™æ˜¯ä¸€ä¸ªé“¾ä¸Šæ¤­åœ†æ›²çº¿ç®—æœ¯åº“ï¼Œè¦æ±‚ä»£ç æåº¦ä¼˜åŒ–ï¼Œè€Œ Solidity å’Œ Yul éƒ½æ— æ³•æ»¡è¶³è¿™ç§æ€§èƒ½éœ€æ±‚

è™½ç„¶ EVM ä¸“å®¶å¯ä»¥ä½¿ç”¨ Huff ç¼–å†™é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„é«˜æ•ˆæ™ºèƒ½åˆçº¦ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä½œä¸ºåˆå­¦è€…å­¦ä¹  EVM å·¥ä½œåŸç†çš„ä¸€ç§æ–¹å¼

> ğŸ‘‰ [Huff è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹](/web3/codelanuage/huff/example)

## å®‰è£…

Huff ç¼–è¯‘å™¨æ˜¯ç”¨ **Rust** å¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›é«˜æ€§èƒ½çš„ Huff ä»£ç ç¼–è¯‘ä½“éªŒ

å®‰è£…æ–¹å¼ä¸ **Foundry** ç±»ä¼¼

1. è¿è¡Œå‘½ä»¤å®‰è£… Huffupï¼š

```bash
curl -L get.huff.sh | bash
```

2. æ³¨æ„äº‹é¡¹ï¼š

* è¯¥å‘½ä»¤ä¼šå®‰è£… `huffup` å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†ä¸ä¸€å®šä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„
* å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

```text
huffup: command not found
```

è¯·æ‰§è¡Œï¼š

```bash
source ~/.bashrc    # æˆ–è€…
source ~/.zshrc
```

* æˆ–è€…ç›´æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£

3. å®‰è£…å®Œæˆå¹¶åœ¨è·¯å¾„ä¸­å¯ç”¨åï¼Œè¿è¡Œï¼š

```bash
huffup
```

å³å¯å®‰è£…æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„ **huffc**ï¼ˆHuff ç¼–è¯‘å™¨ï¼‰



### Windows ç”¨æˆ·ï¼šä»æºç æ„å»º

1. å®‰è£… Rust å·¥å…·é“¾ï¼š

* ä¸‹è½½å¹¶è¿è¡Œ [rustup-init](https://rustup.rs)
* ä¼šåœ¨æ§åˆ¶å°å¯åŠ¨å®‰è£…

2. å¦‚æœé‡åˆ°é”™è¯¯ï¼Œå¯èƒ½ç¼ºå°‘ **VS Build Tools**ï¼Œè¯·ä¸‹è½½å®‰è£…

3. æ„å»º Huffï¼š

```bash
cargo install --git https://github.com/huff-language/huff-rs.git huff_cli --bins --locked
```

4. æ›´æ–° Huffï¼š

* å†æ¬¡æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤å³å¯ä»æºç æ›´æ–°


---

## ä½¿ç”¨ Huff ç¼–è¯‘å™¨ç¼–è¯‘åˆçº¦


### 1. åˆ›å»ºåˆçº¦æ–‡ä»¶

åˆ›å»ºä¸€ä¸ªåä¸º `addition.huff` çš„æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```huff
#define function add(uint256,uint256) nonpayable returns (uint256)

#define macro MAIN() = {
   // ä» calldata ä¸­åŠ è½½ä¸¤ä¸ªæ•°å­—å¹¶ç›¸åŠ 
   0x04 calldataload // [number1]
   0x24 calldataload // [number2]
   add               // [number1 + number2]

   // å°†ç»“æœè¿”å›
   0x00 mstore       // å°†ç»“æœå­˜å…¥å†…å­˜
   0x20 0x00 return  // è¿”å›ç»“æœ
}
```

**è¯´æ˜**ï¼š

* `#define function add(...)` å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ç­¾å
* `#define macro MAIN()` æ˜¯ç¨‹åºå…¥å£
* `calldataload` ä»è°ƒç”¨æ•°æ®ä¸­è¯»å–å‚æ•°
* `add` æ‰§è¡ŒåŠ æ³•æ“ä½œ
* `mstore` å°†ç»“æœå­˜å…¥å†…å­˜
* `return` è¿”å›ç»“æœç»™è°ƒç”¨è€…


### 2. ç¼–è¯‘åˆçº¦

ä½¿ç”¨ `huffc` ç¼–è¯‘åˆçº¦å¹¶è¾“å‡ºå­—èŠ‚ç ï¼š

```bash
huffc addition.huff --bytecode
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```text
61000f8061000d6000396000f36004356024350160005260206000f3
```

å¥½çš„ï¼Œæˆ‘å¸®ä½ æ•´ç†æˆä¸­æ–‡ç¬”è®°é£æ ¼æ–‡æ¡£ï¼š

---

## Huff é¡¹ç›®æ¨¡æ¿

Huff æä¾›äº†ä¸€ä¸ª **é¡¹ç›®æ¨¡æ¿**ï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´æ–¹ä¾¿åœ°å¼€å§‹ç¼–å†™ Huff åˆçº¦


## ä½¿ç”¨æ¨¡æ¿

1. æ‰“å¼€æ¨¡æ¿åœ°å€ï¼š[Huff Project Template](https://github.com/huff-language/huff-project-template)
2. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ **Use this template** æŒ‰é’®ï¼Œå³å¯åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼ŒåŒ…å«æ¨¡æ¿çš„å…¨éƒ¨ä»£ç 
3. å…‹éš†ä»“åº“å¹¶è¿›å…¥æœ¬åœ°ç›®å½•åï¼Œéœ€è¦å®‰è£…é¡¹ç›®ä¾èµ–ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

```bash
forge install
```

4. å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºæˆ–è¿è¡Œæµ‹è¯•ï¼š

```bash
forge build
forge test
```



### æ¨¡æ¿å†…å®¹è¯´æ˜

* **åˆçº¦æ–‡ä»¶ä½ç½®**ï¼š`src/`ï¼ˆHuff åˆçº¦çš„é»˜è®¤å­˜æ”¾ç›®å½•ï¼‰
* ç¤ºä¾‹åˆçº¦ï¼š`src/SimpleStore.huff`

  * åŠŸèƒ½ï¼šæ¼”ç¤ºå¦‚ä½•åœ¨åˆçº¦ä¸­è®¾ç½®å’Œè·å–å­˜å‚¨çš„å€¼
  * å®šä¹‰çš„å‡½æ•°ï¼š

```text
function setValue(uint256);
function getValue() view returns (uint256);
```

* **æµ‹è¯•æ–‡ä»¶ä½ç½®**ï¼š`test/`

  * ç¤ºä¾‹æµ‹è¯•æ–‡ä»¶ï¼š`test/SimpleStore.t.sol`
  * è¯´æ˜ï¼š

    * ç”±äº Foundry åŸç”Ÿä¸æ”¯æŒ Huff ç¼–è¯‘ï¼Œéœ€è¦ä½¿ç”¨ **foundry-huff** åº“
    * é€šè¿‡ `forge` å‘½ä»¤å¯ä»¥ç¼–è¯‘ Huff ä»£ç å¹¶è¿è¡Œæµ‹è¯•
    * è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š

```bash
forge test
```

> æ³¨æ„ï¼šè¦ç¼–è¯‘ Huff ä»£ç ï¼Œ[foundry-huff](https://github.com/huff-language/foundry-huff) ä¾èµ– **Huff ç¼–è¯‘å™¨** å·²å®‰è£…åœ¨ç³»ç»Ÿä¸­



## æ¨¡æ¿å…¶ä»–åŠŸèƒ½

* **é…ç½®æ–‡ä»¶**ï¼š`foundry.toml`

  * ä½äºé¡¹ç›®æ ¹ç›®å½•
  * é…ç½®äº† Forge å·¥å…·é“¾ä½¿ç”¨æ–¹å¼

* **CI é…ç½®**ï¼š`./.github/workflows`

  * åŒ…å« GitHub Actions æ–‡ä»¶
  * ä½¿ç”¨ Foundry å·¥å…·é“¾å’Œ Huff å·¥å…·é“¾è¿è¡ŒæŒç»­é›†æˆï¼ˆCIï¼‰




